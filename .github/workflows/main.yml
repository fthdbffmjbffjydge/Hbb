name: Check CPU Cores on Both Teams (Matrix)
on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  check-team-cores:
    strategy:
      matrix:
        team: [team1, team2]
    runs-on: ${{ matrix.team }}
    
    steps:
    - name: Check CPU Cores and System Info
      run: |
        echo "=== System Information on ${{ matrix.team }} Runner ==="
        echo "Hostname: $(hostname)"
        echo "OS: $(uname -a)"
        echo "CPU Architecture: $(uname -m)"
        echo "--- CPU Core Information ---"
        echo "Total CPU Cores: $(nproc)"
        echo "CPU Model: $(grep -m 1 "model name" /proc/cpuinfo | cut -d: -f2 | xargs)"
        echo "CPU MHz: $(grep -m 1 "cpu MHz" /proc/cpuinfo | cut -d: -f2 | xargs)"
        echo "All CPU MHz: $(grep "cpu MHz" /proc/cpuinfo | cut -d: -f2 | tr '\n' ' ')"
        echo "Min MHz: $(grep "cpu MHz" /proc/cpuinfo | cut -d: -f2 | sort -n | head -1)"
        echo "Max MHz: $(grep "cpu MHz" /proc/cpuinfo | cut -d: -f2 | sort -n | tail -1)"
        echo "--- Memory Information ---"
        echo "Total Memory: $(free -h | grep Mem | awk '{print $2}')"
        echo "Available Memory: $(free -h | grep Mem | awk '{print $7}')"
        echo "--- Disk Information ---"
        echo "Disk Usage:"
        df -h | grep -E '^/dev/'

    - name: Save Core and MHz Info
      run: |
        CORE_COUNT=$(nproc)
        CPU_MHZ=$(grep -m 1 "cpu MHz" /proc/cpuinfo | cut -d: -f2 | xargs)
        echo "CORE_COUNT=$CORE_COUNT" >> $GITHUB_ENV
        echo "CPU_MHZ=$CPU_MHZ" >> $GITHUB_ENV
        echo "${{ matrix.team }} runner has $CORE_COUNT CPU cores at $CPU_MHZ MHz"
        
    - name: Upload System Info
      uses: actions/upload-artifact@v4
      with:
        name: ${{ matrix.team }}-system-info
        path: |
          /proc/cpuinfo
          /proc/meminfo
        retention-days: 1
