name: Monitor Runner CPU on Push

on:
  push:
    branches: [ main ]
  workflow_dispatch:  # Optional manual trigger

jobs:
  check-cpu:
    runs-on: team3
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Monitor CPU usage
      run: |
        echo "ðŸ“Š CPU Monitoring triggered by push to ${{ github.ref }}"
        echo "Commit: ${{ github.sha }}"
        echo "Repository: ${{ github.repository }}"
        echo "================================"
        
        # CPU usage percentage
        CPU_PERCENT=$(top -bn1 | grep "Cpu(s)" | sed 's/.*, *\([0-9.]*\)%* id.*/\1/' | awk '{print 100 - $1}')
        echo "Current CPU Usage: ${CPU_PERCENT}%"
        
        # Load average
        echo "Load Average: $(cat /proc/loadavg | awk '{print $1, $2, $3}')"
        
        # CPU cores
        echo "CPU Cores: $(nproc)"
        
        # Memory usage
        echo -e "\nMemory Usage:"
        free -h
